# DengFeng Robotic Competition Simulation Platform

## 概述

- 两辆小车，在一个放置有多个障碍物、道具的场地中，移动并攻击对方，将对方生命值降低到0以获取胜利。
- 小车可控制小车移动、释放技能影响对手。
    - 左右轮的线速度`left_speed, right_speed`，默认限制为`±50cm/s`。合适的左右轮速度可实现前进、后退、转弯等。
    - 舵机目标角度`steer_angle`，单位`deg`。此角度是相对于小车头部的相对角度。舵机的转速有限，不超过`90deg/s`。
    - 使用各类主动技能`PlayerAction`，包括射击`Attack1/2/3`，填充弹夹`ChangeMag`，发射冰冻射线`FrozenRays`等。
- 小车可获得场地内的各类信息`info`，包括障碍物`info.obs`、道具等`info.props`。若敌方小车在视野内，还可获得敌方小车的信息`info.cars`。
- 游戏为回合制，每个回合的时长为`1/FREQ s`（目前`FREQ=30`），选手代码需利用场地内各类信息快速判断并给出当前回合采取的行动。
- 时间单位均为`s`。长度单位均为`cm`。角度单位均为`deg`，逆时针为正。

## 场地

- 基本
    - 场地为`400cm*300cm`的长方形，通过`Point<double>`类型指明坐标。
- 道具
    - 类型和作用
        - HP包`HP_PAK`：立即增加生命值`50`；不能抢对手的HP包。
        - MP包`MP_PAK`：立即增加魔法值`50`；不能抢对手的MP包。
        - 加速道具`SPD_BUFF`：我方左右轮线速度提高到`±75cm/s`，持续`10s`；
        - 防御道具`DEF_BUFF`：我方受到的伤害降低一半，持续`10s`；
    - 产生和获取
        - 所有道具都会出现在固定位置上。详情请查看`map.txt`文件。
        - 比赛开始后`2s`，所有道具自动出现在固定位置上。
        - 道具被消耗后进入冷却，冷却完成之后在固定位置刷新。HP包和MP包冷却时间为`20s`，加速和防御道具冷却时间为`15s`。
        - 小车的坐标和可获取的道具小于`RADIUS_PROP`，则立即生效。若在判定时多名角色都在判定范围内，则都生效。
- 视野
    - 小车的视野取决于舵机**绝对**方向，视角为`90deg`。
    - 地图内的多个圆形固定障碍物会阻碍选手移动、阻挡选手视野、阻挡选手的射击。
    - 小车可获得信息`info`：
        - 障碍物`info.obs`不会变化。
        - 道具`info.props`中是在场上且己方可获取的道具信息。
        - 若敌方小车在视野内，`info.cars`中将有敌方小车的信息；若看不到敌方小车，`info.cars`是空的。

## 小车

- 基本信息
    - 选手ID`info.id`：0或1，代表自己是从哪一边出发的。记住只能吃自己一侧的`HP_PAK,MP_PAK`。
    - 位置信息
        - 坐标`info.coor`：`info.coor.x`和`info.coor.y`即为对应的XY坐标。
        - 车身朝向`info.car_angle`：单位`deg`，逆时针为正。
        - 舵机相对方向`info.attack_angle`：单位`deg`，逆时针为正。这是相对于车身朝向的角度。舵机**绝对**方向即`info.attack_angle + info.car_angle`。
    - 常规状态
        - 生命值`info.hp`：上限`100`，降为`0`时失败。只能通过吃`HP_PAK`回复。
        - 魔法值`info.mp`：上限`100`，可消耗之释放主动技能。自动回复速度为`2MP/s`
        - 弹夹数`info.mag`： 上限`12`，射击会消耗弹夹数。填充弹夹`ChangeMag`技能发出`2s`后弹夹数恢复`12`。
    - 特殊状态
        - 加速状态`info.spd_status`：此状态下左右轮线速度限制为`±75cm/s`；吃到加速道具`SPD_BUFF`或使用加速技能`SpeedUp`可获得此状态。
        - 减速状态`info.frz_status`：此状态下左右轮线速度限制为`±25cm/s`；敌方使用`FrozenRays`并击中时我方会获得此状态。
        - 防御状态`info.shd_status`：此状态下我方受到的伤害降低一半。
- 主动技能`PlayerAction`详解
    - 不行动`NoAction`：没有效果
    - 射击`Attack1/2/3`；使用前请检查`info.can_atk`。
        - `Attack1/2/3`分别消耗`1/2/3 MAG`。射击的冷却时间为`0.5s`。
        - 射击方向和舵机方向一致。若有障碍物阻挡，则无法命中。
        - 若无阻挡且射正，距离敌方`ATK_BEST_LEN=30`内命中率`100%`，距离敌方`ATK_MAX_LEN=200`及以外命中率下降到`0%`，其间距离和命中率成线性关系。
        - 击中敌方机身不同位置，会造成不同倍率的伤害。命中敌方会击退敌方一段距离。
            - 弹药 -- 正面 -- 侧面 -- 后面
            - 1MAG -- 2HP  -- 3HP  -- 4HP
            - 2MAG -- 4HP  -- 6HP  -- 8HP
            - 3MAG -- 6HP  -- 9HP  -- 12HP
    - 换弹夹`ChangeMag`：己方进入换弹状态，持续`2s`，此状态下不能射击`Attack1/2/3`。
    - 冰冻射线`FrozenRays`；使用前请检查`info.can_frz`。
        - 命中判定和射击相同。若命中，敌方受到减速效果（左右轮线速度下降到`±25cm/s`），持续`10s`
        - 技能消耗`30MP`，冷却时间`10s`。
    - 加速`SpeedUp`；使用前请检查`info.can_spd`。
        - 直接生效，我方获得加速效果（左右轮线速度提高到`±75cm/s`），持续`10s`。
        - 技能消耗`60MP`，冷却时间`20s`。
    - 能量护罩`Shield`；使用前请检查`info.can_shd`。
        - 直接生效，我方获得减伤效果（受到伤害降低一半），持续`10s`。
        - 技能消耗`60MP`，冷却时间`20s`。
- 坐标控制详解
    - 左右轮线速度`left_speed, right_speed`将影响下一回合我方位置。
    - 在没有障碍物和敌方卡位的情况下，下一回合（每回合时长`1/FREQ s`）的坐标可通过以下公式计算：
        - 位移长度 `l = ( left_speed/FREQ + right_speed/FREQ ) / 2;`
        - 新的车身朝向 `new_car_angle = car_angle + ( -left_speed/FREQ + right_speed/FREQ ) / 2 / RADIUS_CAR * 180/3.14159`
        - 新的坐标 `new_coor = coor + Point<double>(cos_d(new_car_angle), sin_d(new_car_angle)) * l;`

## 特殊规则和提示

- 速度状态覆盖
    - 吃到加速道具`SPD_BUFF`或使用加速技能`SpeedUp`后，被冰冻射线`FrozenRays`命中，则立即进入`10s`的减速状态，之前的加速状态被覆盖；反之也是如此。
- 超时惩罚
    - 防止比赛时间过长，比赛开始2min后，双方开始持续受到`1HP/s`的伤害；3min后受到`2HP/s`的伤害；4min后受到`3HP/s`的伤害。此伤害不受防御状态影响。
- 出界惩罚
    - 若小车跑到了地图之外，将持续扣血`5HP/s`。此伤害不受防御状态影响。
- 生命值细节
    - 在内部判定中，生命值其实是一个小数。但选手只能看到向下取整的生命值。 
    - 若在比赛结束时，双方血量均显示为0，则判定为平局。
